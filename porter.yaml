# This is the configuration for Porter
# You must define steps for each action, but the rest is optional
# See https://getporter.org/bundle/manifest/file-format/ for a description of all the allowed fields in this document.
# See https://getporter.org/author-bundles for documentation on how to configure your bundle.
# Uncomment out the sections below to take full advantage of what Porter can do!

# Optional indicator of the resource type of this file
schemaType: Bundle

# Version of the porter.yaml schema used by this file.
schemaVersion: 1.0.1

# Name of the bundle
name: fabricbundle_43

# Version of the bundle. Change this each time you modify a published bundle.
version: 0.1.0

# Description of the bundle and what it does.
description: "An example Porter configuration"

# Registry where the bundle is published to by default
registry: "localhost:5000"

# If you want to customize the Dockerfile in use, uncomment the line below and update the referenced file. 
# See https://getporter.org/bundle/custom-dockerfile/
dockerfile: template.Dockerfile

parameters:
  - name: subscriptionId
    type: string
    default: "default_subscription"
    isRequired: false
  - name: resourceGroup
    default: "default_resourcegroup"
    type: string
    isRequired: false
  - name: location
    default: "default_location"
    type: string
    isRequired: false
  - name: workspaceDisplayName
    type: string
    isRequired: false
  - name: workspaceDescription
    type: string
    default: "United Fabric Workspace"
    isRequired: false
  - name: capacityId
    type: string
    isRequired: false
  - name: correlationId
    type: string
    isRequired: false
  - name: itemDisplayName
    type: string
    isRequired: false
  - name: itemDescription
    type: string
    default: "United Fabric Item"
    isRequired: false
  - name: itemType
    type: string
    isRequired: false
  - name: workspaceId ## Only if Item is passed in Porter YAML.
    type: string
    default: ""
    isRequired: false

credentials:
  - name: Microsoft_Fabric_Token
    env: Microsoft_Fabric_Token
    applyTo: 
      - install
  - name: Microsoft_StatusDBConnectionString
    env: Microsoft_StatusDBConnectionString
    applyTo:
      - install 

outputs:
  - name: workspace_id
    type: string
    default: "wrongid"
    sensitive: false
    applyTo:
      - install
  - name: item_id
    type: string
    default: "Operation_Failed"
    sensitive: false
    applyTo:
      - install

# outputs:
#   - name: ID
#     type: string
#     sensitive: false
#     applyTo:
#       - install
# parameters: 
#   - name: token
#     type: string
#   - name: workspaceDisplayName
#     type: string
#   - name: workspaceDescription
#     type: string
#   - name: capacityId
#     type: string
#   - name: itemDisplayName
#     type: string
#   - name: itemType
#     type: string
#   - name: workspaceId
#     type: string
# parameters:  
#   - name: Licenses
#     type: array
#     default: 
#       # {'skus':[{'skus': ['POWERAPPS_DEV','MS_CLOUD_HEALTHCARE'],'operator': 'AND'},{'skus': ['POWERAPPS_DEV','MCS_BizApps_Cloud_for_Sustainability_USL'],'operator': 'OR'}],'isRequired': true,'$comment': '<ApplicableClouds>PowerPlatform</ApplicableClouds><Source>ReadOnly</Source>'}
#       - skus: ["POWERAPPS_DEV","MS_CLOUD_HEALTHCARE"]
#         operator: AND
#       - skus: ["POWERAPPS_DEV","MCS_BizApps_Cloud_for_Sustainability_USL"]
#         operator: OR
#     isRequired: true
#     $comment: <ApplicableClouds>PowerPlatform</ApplicableClouds><Source>ReadOnly</Source>
# Declare and optionally configure the mixins used by the bundle
mixins:
  - fabric
install:
  - fabric:
      description: "Creating Workspace"
      group: core.workspace
      operation: CreateWorkspace
      flags:
        displayName: ${ bundle.parameters.workspaceDisplayName }
        type: "Workspace"
        Token: ${ bundle.credentials.Microsoft_Fabric_Token }
        capacityId: ${ bundle.parameters.capacityId }
        description: ${ bundle.parameters.workspaceDescription }
        correlationId: ${ bundle.parameters.correlationId }
        statusDBConnectionString: ${ bundle.credentials.Microsoft_StatusDBConnectionString }
      outputs:
          - name: "workspace_id"
            jsonPath: "$.id"
  - fabric:
      description: "Creating fabric Item"
      group: core.items
      operation: CreateItem
      flags:
        displayName: ${ bundle.parameters.itemDisplayName }
        type: ${ bundle.parameters.itemType }
        Token: ${ bundle.credentials.Microsoft_Fabric_Token }
        workspaceId: "5e389810-8c6d-4f70-831f-b5753afd8036" #${ bundle.outputs.workspace_id }
        definition: "{}" 
        description: ${ bundle.parameters.itemDescription }
        correlationId: ${ bundle.parameters.correlationId }
        statusDBConnectionString: ${ bundle.credentials.Microsoft_StatusDBConnectionString }
      outputs:
        - name: "item_id"
          jsonPath: "$.id"
  # - fabric:
  #     description: "Creating Item"
  #     group: core.Item
  #     operation: CreateItem
  #     flags:
  #       displayName: "Workspace1111111111"
  #       type: "Lakehouse"
  #       workspaceId: "53953d02-6771-449e-98e1-c78a997b22f1"
  #       definition: "tyt" 
  #       description: "My Warehouse"
  #       correlationId: "eyJ0eXAiOiJ"
  #       Token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InEtMjNmYWxldlpoaEQzaG05Q1Fia1A1TVF5VSIsImtpZCI6InEtMjNmYWxldlpoaEQzaG05Q1Fia1A1TVF5VSJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3LyIsImlhdCI6MTcxMzI0NTI5OCwibmJmIjoxNzEzMjQ1Mjk4LCJleHAiOjE3MTMyNTAxNTIsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBZVFBRy84V0FBQUFCcU5MMFZyay8zdWFiT2Y0VzJZOUNjOExuaTI5OFFselVCUFlBVkxpbUp5MktkZllZcHkxZmhnQkhFbUxlZ1hQMld5aWRiUjZMOWR6WC94ZTkzaU1NbmdNZ2hWVmZlY0NOS3c3R2ovRFRMUFB5MW9BV0pGNUswajlYajYvVFpmdk5DMFoxbWJRYWNEMXlVOGxFb3FGRnJUN2I2VEIwZGlNQVlFOGdWZ3FGMkFKUmdZcEZCL2NvY0FvS25pNDZrOW0vRTdwYkJ2TzJ2K3QrK1kraVNaeDcydWRnOVQ3T2pITFliUTZGUHJaODVQcmxwTk04U2U4ZGIrdFJYT1dzcW51eFl3UEtabWhYNlU4dDZ5UEg5NFdkZDBDZ2tNRzdNMDNLOVpsUEgwQUxoZz0iLCJhbXIiOlsicnNhIiwibWZhIl0sImFwcGlkIjoiODcxYzAxMGYtNWU2MS00ZmIxLTgzYWMtOTg2MTBhN2U5MTEwIiwiYXBwaWRhY3IiOiIyIiwiY29udHJvbHMiOlsiYXBwX3JlcyJdLCJjb250cm9sc19hdWRzIjpbIjg3MWMwMTBmLTVlNjEtNGZiMS04M2FjLTk4NjEwYTdlOTExMCIsIjAwMDAwMDA5LTAwMDAtMDAwMC1jMDAwLTAwMDAwMDAwMDAwMCIsIjAwMDAwMDAzLTAwMDAtMGZmMS1jZTAwLTAwMDAwMDAwMDAwMCJdLCJkZXZpY2VpZCI6ImVkYzdjZjYzLTdhZGMtNDY4Zi04OGIyLTk0N2I0MDg3NTY3YiIsImZhbWlseV9uYW1lIjoiU2hhbmRpbHlhIiwiZ2l2ZW5fbmFtZSI6Ikt1bXVkIiwiaXBhZGRyIjoiMjQwNDpmODAxOjgwMjg6Mzo4ZDFhOmU5Njo3ZDI5OjY5YjQiLCJuYW1lIjoiS3VtdWQgU2hhbmRpbHlhIiwib2lkIjoiMDk4MGRlZWQtN2U0ZC00YjNkLWJjMTgtZTQ0NDNkYTJjMGIwIiwib25wcmVtX3NpZCI6IlMtMS01LTIxLTIxMjc1MjExODQtMTYwNDAxMjkyMC0xODg3OTI3NTI3LTY5NDQ0MDcyIiwicHVpZCI6IjEwMDMyMDAyQzA3MUExOTgiLCJyaCI6IjAuQVJvQXY0ajVjdkdHcjBHUnF5MTgwQkhiUndrQUFBQUFBQUFBd0FBQUFBQUFBQUFhQURNLiIsInNjcCI6InVzZXJfaW1wZXJzb25hdGlvbiIsInNpZ25pbl9zdGF0ZSI6WyJkdmNfbW5nZCIsImR2Y19jbXAiLCJpbmtub3dubnR3ayIsImttc2kiXSwic3ViIjoiSmpqdzFqOWFXRUs3QndpUjNCd3ViNFJ0MWFVWjlFaTdnaEE5Q3RZbjRuQSIsInRpZCI6IjcyZjk4OGJmLTg2ZjEtNDFhZi05MWFiLTJkN2NkMDExZGI0NyIsInVuaXF1ZV9uYW1lIjoia3NoYW5kaWx5YUBtaWNyb3NvZnQuY29tIiwidXBuIjoia3NoYW5kaWx5YUBtaWNyb3NvZnQuY29tIiwidXRpIjoiNnZteHdDNnNERWlSZ0w3b1dWUVFBQSIsInZlciI6IjEuMCIsIndpZHMiOlsiYjc5ZmJmNGQtM2VmOS00Njg5LTgxNDMtNzZiMTk0ZTg1NTA5Il19.0JVKvvnCpMOE0H7d8IW5Qeddh2fou3sjMaR_xek7DWqew7OreGO0iqqCeUuxLAw8oQIE1XtkqsP2VAEcDDoitaKCGu_O0VBPWDQxrM5f-IGnT7JSmQVNvSnZExy6KYCoEVV6h5sT5DyHnmc9Q0TCiBldL_PQYL4AEXl9WiENE6zd5msCOEL4_BaOX2sLxIFv_3zfkyWWuretIPz0rV7HgIm-D79VJie33XKXjRfHRNYWJuBpJHpyayHoAywWR8vWpd90i6YUmPNTHEh8OE2ueSkX93p1-OHMknQOfADuP9CtaG5KPPvLGg-kpNC5VuM5qHXeFJiAgngZ6TpxRkia4w"
  #     outputs:
  #       - name: "item_id"
  #         jsonPath: "$.id"
  # - fabric: 
  #     description: "Updating Workspace"
  #     group: core.workspace
  #     operation: UpdateWorkspace
  #     flags:
  #       displayName: ${ bundle.parameters.itemDisplayName }
  #       Token: ${ bundle.credentials.Microsoft_Fabric_Token }
  #       workspaceId: "5e389810-8c6d-4f70-831f-b5753afd80i6" #${ bundle.outputs.workspace_id }
  #       description: ${ bundle.parameters.itemDescription }
  #       correlationId: ${ bundle.parameters.correlationId }
  #       statusDBConnectionString: ${ bundle.credentials.Microsoft_StatusDBConnectionString }
  #     outputs:
  #     - name: "item_id"
  #       jsonPath: "$.id"
  # - fabric: 
  #     description: "Updating Item"
  #     group: core.Item
  #     operation: UpdateItem
  #     flags: 
  #       workspaceId: "53953d02-6771-449e-98e1-c78a997b22f1"
  #       itemId: "00d3a35e-2bce-4158-a725-b397c18dd6ce"
  #       displayName: "newName"
  #       description: "new"
  #       correlationId: "eyJ0eXAiOiJ"
  #       Token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InEtMjNmYWxldlpoaEQzaG05Q1Fia1A1TVF5VSIsImtpZCI6InEtMjNmYWxldlpoaEQzaG05Q1Fia1A1TVF5VSJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3LyIsImlhdCI6MTcxMzI0ODg5NiwibmJmIjoxNzEzMjQ4ODk2LCJleHAiOjE3MTMyNTQ1ODUsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBZVFBRy84V0FBQUFYdmUzb1VlSU5xNWtZd3ZGNk5RT0F1TUhNZ1oyclUvdTJZenpVWjRHc3FsdHdoUHU0RmpicFptbEJId1A0TC9sOElya3hZMi9TVkQ2eUJRL0VUblpyYytMMk5PbjlGSW5lSDRFTWNtb29VRkkycmFjTWRPeWRSZWZsK2s5YTBvY01DdDBkNTBWcG1HVC9jSk5xb090NkVuY2RScEdRdmloYlNkd3VCdzVGMWE3U0VPR2FQaUd4NnpEYUdKR0lzclNGSlN0KytJQ0Y3MGdiTUNvSmZqeVhTWDc2cklRYitTSngvTVZPL3JoSTJDSWJVdkVUZU5WUjdyOEltUTRPMkd1VUxjVmJ1bnF2UFJzZGVnMFVSN0VRdVlTbWp4U2Z3ZVExS0o0UlRhbnlWMD0iLCJhbXIiOlsicnNhIiwibWZhIl0sImFwcGlkIjoiODcxYzAxMGYtNWU2MS00ZmIxLTgzYWMtOTg2MTBhN2U5MTEwIiwiYXBwaWRhY3IiOiIyIiwiY29udHJvbHMiOlsiYXBwX3JlcyJdLCJjb250cm9sc19hdWRzIjpbIjg3MWMwMTBmLTVlNjEtNGZiMS04M2FjLTk4NjEwYTdlOTExMCIsIjAwMDAwMDA5LTAwMDAtMDAwMC1jMDAwLTAwMDAwMDAwMDAwMCIsIjAwMDAwMDAzLTAwMDAtMGZmMS1jZTAwLTAwMDAwMDAwMDAwMCJdLCJkZXZpY2VpZCI6ImVkYzdjZjYzLTdhZGMtNDY4Zi04OGIyLTk0N2I0MDg3NTY3YiIsImZhbWlseV9uYW1lIjoiU2hhbmRpbHlhIiwiZ2l2ZW5fbmFtZSI6Ikt1bXVkIiwiaXBhZGRyIjoiMjQwNDpmODAxOjgwMjg6Mzo4ZDFhOmU5Njo3ZDI5OjY5YjQiLCJuYW1lIjoiS3VtdWQgU2hhbmRpbHlhIiwib2lkIjoiMDk4MGRlZWQtN2U0ZC00YjNkLWJjMTgtZTQ0NDNkYTJjMGIwIiwib25wcmVtX3NpZCI6IlMtMS01LTIxLTIxMjc1MjExODQtMTYwNDAxMjkyMC0xODg3OTI3NTI3LTY5NDQ0MDcyIiwicHVpZCI6IjEwMDMyMDAyQzA3MUExOTgiLCJyaCI6IjAuQVJvQXY0ajVjdkdHcjBHUnF5MTgwQkhiUndrQUFBQUFBQUFBd0FBQUFBQUFBQUFhQURNLiIsInNjcCI6InVzZXJfaW1wZXJzb25hdGlvbiIsInNpZ25pbl9zdGF0ZSI6WyJkdmNfbW5nZCIsImR2Y19jbXAiLCJpbmtub3dubnR3ayIsImttc2kiXSwic3ViIjoiSmpqdzFqOWFXRUs3QndpUjNCd3ViNFJ0MWFVWjlFaTdnaEE5Q3RZbjRuQSIsInRpZCI6IjcyZjk4OGJmLTg2ZjEtNDFhZi05MWFiLTJkN2NkMDExZGI0NyIsInVuaXF1ZV9uYW1lIjoia3NoYW5kaWx5YUBtaWNyb3NvZnQuY29tIiwidXBuIjoia3NoYW5kaWx5YUBtaWNyb3NvZnQuY29tIiwidXRpIjoiUzEtVkpOUGpZay1QVFZ5MWdLd05BQSIsInZlciI6IjEuMCIsIndpZHMiOlsiYjc5ZmJmNGQtM2VmOS00Njg5LTgxNDMtNzZiMTk0ZTg1NTA5Il19.3Zs8pofnPMf-7pHZn4KqJna3WsyzqFfhVy9g7MqOMNXYzDoA_yWRyIwFDrEgSJ_EUml4HqsEgujZyrImESXg9QkKcWnmhGVJ37Vm7UD_a_GN8DLesZp92tFQJSq6rFvTi0VDnqOf1NhmhXWYYfk7Q7Q4zhKC_aa4p-4cWpCoAL597mPPpnflwfQbLC3iNU-RVU5dc2l9MTAsJgWA-jFL_8gdoICKbzY8NIRLj9DPKWNEDvJ0c2xQO64P3UW2Klfom-weIior9XM6etobh3VJhbzgky0T5luTeczT9jxgeyx37XggCIbHCV8zN7wfqeZd47xsoW86Vft7rx4yve1oFQ"
  #     outputs:
  #     - name: "item_id"
  #       jsonPath: "$.id"
  # - fabric: 
  #     description: "Getting Workspace"
  #     group: core.workspace
  #     operation: GetWorkspace
  #     flags: 
  #       Token: ${ bundle.credentials.Microsoft_Fabric_Token }
  #       correlationId: ${ bundle.parameters.correlationId }
  #       workspaceId: "5e389810-8c6d-4f70-831f-b5753afd80i6"
  # - fabric: 
  #     description: "Listing Workspaces"
  #     group: core.workspace
  #     operation: ListWorkspace
  #     flags: 
  #       Token: ${ bundle.credentials.Microsoft_Fabric_Token }
  #       correlationId: ${ bundle.parameters.correlationId }


upgrade:
  - fabric: 
      workspace: "<Worspace ID>"
      token: "<Your Token>"
      item: "<Item ID>"
      arguments: {"displayName": "updatedname1", "description": "Item's New description"}

uninstall:
  - fabric: 
      workspace: "<Worspace ID>"
      token: "<Your Token>"
      item: "<Item ID>"
